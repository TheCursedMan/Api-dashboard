<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SET Index and Investor Data</title>
</head>
<body>
    <h1>SET Index Data</h1>
    <div>
        <p>SET Index Price: <span id="setindex_price_box">Loading...</span></p>
        <p>SET Index Tick Change: <span id="setindex_tickchg_box">Loading...</span></p>
        <p>SET Index Percent Change: <span id="setindex_percentchg_box">Loading...</span></p>
    </div>

    <h1>Investor Group Data</h1>
    <div>
        <h2>สถาบันในประเทศ</h2>
        <p>Buy: <span id="Institutional_buy_box">Loading...</span></p>
        <p>Sell: <span id="Institutional_sell_box">Loading...</span></p>
        <p>Net: <span id="Institutional_sum_box">Loading...</span></p>
    </div>

    <div>
        <h2>บัญชีบริษัทหลักทรัพย์</h2>
        <p>Buy: <span id="exchangeacc_buy_box">Loading...</span></p>
        <p>Sell: <span id="exchangeacc_sell_box">Loading...</span></p>
        <p>Net: <span id="exchangeacc_sum_box">Loading...</span></p>
    </div>

    <div>
        <h2>นักลงทุนต่างประเทศ</h2>
        <p>Buy: <span id="foreigninv_buy_box">Loading...</span></p>
        <p>Sell: <span id="foreigninv_sell_box">Loading...</span></p>
        <p>Net: <span id="foreigninv_sum_box">Loading...</span></p>
    </div>

    <div>
        <h2>นักลงทุนในประเทศ</h2>
        <p>Buy: <span id="commoninv_buy_box">Loading...</span></p>
        <p>Sell: <span id="commoninv_sell_box">Loading...</span></p>
        <p>Net: <span id="commoninv_sum_box">Loading...</span></p>
    </div>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                const setindex_data = data.setIndexData;
                const investorGroup_data = data.investorGroup;

                const set_price = setindex_data.data_price;
                const set_tickchg = setindex_data.tick_changed != null ? setindex_data.tick_changed : "-";
                const set_perchg = setindex_data.tick_percent_changed != null ? setindex_data.tick_percent_changed : "-";

                document.getElementById('setindex_price_box').innerText = set_price;
                document.getElementById('setindex_tickchg_box').innerText = set_tickchg;
                document.getElementById('setindex_percentchg_box').innerText = set_perchg;

                investorGroup_data.forEach(e => {
                    if(e.investor === 'สถาบันในประเทศ'){
                        document.getElementById('Institutional_buy_box').innerText = e.buy;
                        document.getElementById('Institutional_sell_box').innerText = e.sell;
                        document.getElementById('Institutional_sum_box').innerText = e.net;
                    }
                    else if(e.investor === 'บัญชีบริษัทหลักทรัพย์'){
                        document.getElementById('exchangeacc_buy_box').innerText = e.buy;
                        document.getElementById('exchangeacc_sell_box').innerText = e.sell;
                        document.getElementById('exchangeacc_sum_box').innerText = e.net;
                    }
                    else if(e.investor === 'นักลงทุนต่างประเทศ'){
                        document.getElementById('foreigninv_buy_box').innerText = e.buy;
                        document.getElementById('foreigninv_sell_box').innerText = e.sell;
                        document.getElementById('foreigninv_sum_box').innerText = e.net;
                    }
                    else if(e.investor === 'นักลงทุนในประเทศ'){
                        document.getElementById('commoninv_buy_box').innerText = e.buy;
                        document.getElementById('commoninv_sell_box').innerText = e.sell;
                        document.getElementById('commoninv_sum_box').innerText = e.net;
                    }
                });

            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('setindex_price_box').innerText = '###';
                document.getElementById('setindex_tickchg_box').innerText = '###';
                document.getElementById('setindex_percentchg_box').innerText = '###';
            }
        }

        window.onload = fetchData;
    </script>
</body>
</html>
